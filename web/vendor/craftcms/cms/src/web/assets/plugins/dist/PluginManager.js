!function(){var e={811:function(){},447:function(e,t,n){var a=n(811);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals),(0,n(673).Z)("7690077b",a,!0,{})},673:function(e,t,n){"use strict";function a(e,t){for(var n=[],a={},i=0;i<t.length;i++){var s=t[i],r=s[0],l={id:e+":"+i,css:s[1],media:s[2],sourceMap:s[3]};a[r]?a[r].parts.push(l):n.push(a[r]={id:r,parts:[l]})}return n}n.d(t,{Z:function(){return f}});var i="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!i)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var s={},r=i&&(document.head||document.getElementsByTagName("head")[0]),l=null,o=0,d=!1,p=function(){},u=null,c="data-vue-ssr-id",h="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function f(e,t,n,i){d=n,u=i||{};var r=a(e,t);return g(r),function(t){for(var n=[],i=0;i<r.length;i++){var l=r[i];(o=s[l.id]).refs--,n.push(o)}for(t?g(r=a(e,t)):r=[],i=0;i<n.length;i++){var o;if(0===(o=n[i]).refs){for(var d=0;d<o.parts.length;d++)o.parts[d]();delete s[o.id]}}}}function g(e){for(var t=0;t<e.length;t++){var n=e[t],a=s[n.id];if(a){a.refs++;for(var i=0;i<a.parts.length;i++)a.parts[i](n.parts[i]);for(;i<n.parts.length;i++)a.parts.push(m(n.parts[i]));a.parts.length>n.parts.length&&(a.parts.length=n.parts.length)}else{var r=[];for(i=0;i<n.parts.length;i++)r.push(m(n.parts[i]));s[n.id]={id:n.id,refs:1,parts:r}}}}function v(){var e=document.createElement("style");return e.type="text/css",r.appendChild(e),e}function m(e){var t,n,a=document.querySelector("style["+c+'~="'+e.id+'"]');if(a){if(d)return p;a.parentNode.removeChild(a)}if(h){var i=o++;a=l||(l=v()),t=b.bind(null,a,i,!1),n=b.bind(null,a,i,!0)}else a=v(),t=$.bind(null,a),n=function(){a.parentNode.removeChild(a)};return t(e),function(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap)return;t(e=a)}else n()}}var y,C=(y=[],function(e,t){return y[e]=t,y.filter(Boolean).join("\n")});function b(e,t,n,a){var i=n?"":a.css;if(e.styleSheet)e.styleSheet.cssText=C(t,i);else{var s=document.createTextNode(i),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(s,r[t]):e.appendChild(s)}}function $(e,t){var n=t.css,a=t.media,i=t.sourceMap;if(a&&e.setAttribute("media",a),u.ssrId&&e.setAttribute(c,t.id),i&&(n+="\n/*# sourceURL="+i.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */"),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}}},t={};function n(a){var i=t[a];if(void 0!==i)return i.exports;var s=t[a]={id:a,exports:{}};return e[a](s,s.exports,n),s.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";n(447),function(e){Craft.PluginManager=Garnish.Base.extend({$table:null,init:function(){var n=this;this.$table=e("#plugins"),this.$table.length&&this.$table.find("tbody tr").each((function(t,n){var a=e(n),i=a.find(".action-btn").disclosureMenu().data("disclosureMenu");i&&(i.$container.find('[data-action="copy-plugin-handle"]').on("activate",(function(){Craft.ui.createCopyTextPrompt({label:Craft.t("app","Plugin Handle"),value:a.data("handle")})})),i.$container.find('[data-action="copy-package-name"]').on("activate",(function(){Craft.ui.createCopyTextPrompt({label:Craft.t("app","Package Name"),value:a.data("package-name")})})))})),this.getPluginLicenseInfo().then((function(a){for(var i in a)a.hasOwnProperty(i)&&(a[i].isComposerInstalled?new t(n,e("#plugin-"+i)).update(a[i]):n.addUninstalledPluginRow(i,a[i]))}))},getPluginLicenseInfo:function(){return new Promise((function(e,t){Craft.sendApiRequest("GET","cms-licenses",{params:{include:"plugins"}}).then((function(n){var a={pluginLicenses:n.license.pluginLicenses||[]};Craft.sendActionRequest("POST","app/get-plugin-license-info",{data:a}).then((function(t){e(t.data)})).catch((function(){t()}))})).catch(t)}))},addUninstalledPluginRow:function(t,n){this.$table.length||(this.$table=e("<table/>",{id:"plugins",class:"data fullwidth collapsible",html:"<tbody></tbody>"}),e("#no-plugins").replaceWith(this.$table));var a=e("<tr/>",{data:{handle:t}}).appendTo(this.$table.children("tbody")).append(e("<th/>").append(e("<div/>",{class:"plugin-infos"}).append(e("<div/>",{class:"icon"}).append(e("<img/>",{src:n.iconUrl}))).append(e("<div/>",{class:"plugin-details"}).append(e("<h2/>",{text:n.name})).append(n.description?e("<p/>",{text:n.description}):e()).append(n.documentationUrl?e("<p/>",{class:"links"}).append(e("<a/>",{href:n.documentationUrl,target:"_blank",text:Craft.t("app","Documentation")})):e()).append(e("<div/>",{class:"flex license-key"}).append(e("<div />",{class:"pane"}).append(e("<input/>",{class:"text code",size:29,maxlength:29,value:Craft.PluginManager.normalizeUserKey(n.licenseKey),readonly:!0,disabled:!0}))))))).append(e("<td/>",{class:"nowrap","data-title":Craft.t("app","Status")}).append(e("<span/>",{class:"status disabled"})).append(e("<span/>",{class:"light",text:Craft.t("app","Missing")}))).append(e("<td/>",{class:"nowrap thin actions-cell"}));if(Craft.initUiElements(a),n.latestVersion){var i=a.find(".actions-cell");i.attr("data-title",Craft.t("app","Actions"));var s="menu-".concat(Math.floor(1e6*Math.random())),r=e("<button/>",{type:"button",class:"btn menubtn action-btn hairline","aria-label":Craft.t("app","Actions"),"aria-controls":s,title:Craft.t("app","Actions"),"data-disclosure-trigger":""}).appendTo(i);e("<div/>",{id:s,class:"menu menu--disclosure"}).appendTo(i);var l=r.disclosureMenu().data("disclosureMenu");l.addItems([{icon:"clipboard",label:Craft.t("app","Copy plugin handle"),onActivate:function(){Craft.ui.createCopyTextPrompt({label:Craft.t("app","Plugin Handle"),value:t})}},{icon:"clipboard",label:Craft.t("app","Copy package name"),onActivate:function(){Craft.ui.createCopyTextPrompt({label:Craft.t("app","Package Name"),value:n.packageName})}}]),l.addHr(),l.addGroup(),l.addItem({icon:"plus",label:Craft.t("app","Install"),action:"pluginstore/install",params:{packageName:n.packageName,handle:t,edition:n.licensedEdition,version:n.latestVersion,licenseKey:n.licenseKey,return:"settings/plugins"}})}}},{normalizeUserKey:function(e){return"string"!=typeof e||""===e?"":"$"===e[0]?e:e.replace(/.{4}/g,"$&-").substring(0,29).toUpperCase()}});var t=Garnish.Base.extend({manager:null,$row:null,$details:null,$keyContainer:null,$keyInput:null,$spinner:null,$buyBtn:null,handle:null,updateTimeout:null,init:function(e,t){this.manager=e,this.$row=t,this.$details=this.$row.find(".plugin-details"),this.$keyContainer=t.find(".license-key"),this.$keyInput=this.$keyContainer.find("input.text").removeAttr("readonly"),this.$buyBtn=this.$keyContainer.find(".btn"),this.$spinner=t.find(".spinner"),this.handle=this.$row.data("handle"),this.addListener(this.$keyInput,"focus","onKeyFocus"),this.addListener(this.$keyInput,"input","onKeyChange")},getKey:function(){return this.$keyInput.val().replace(/\-/g,"").toUpperCase()},onKeyFocus:function(){this.$keyInput.select()},onKeyChange:function(){this.updateTimeout&&clearTimeout(this.updateTimeout);var e=this.getKey();if(0===e.length||24===e.length||e.length>1&&"$"===e[0]){var t=Craft.PluginManager.normalizeUserKey(e);this.$keyInput.val(t),this.updateTimeout=setTimeout(this.updateLicenseStatus.bind(this),100)}},updateLicenseStatus:function(){var e=this;this.$spinner.removeClass("hidden");var t={handle:this.handle,key:this.getKey()};Craft.sendActionRequest("POST","app/update-plugin-license",{data:t}).then((function(){e.manager.getPluginLicenseInfo().then((function(t){e.$spinner.addClass("hidden"),e.update(t[e.handle])}))}))},update:function(t){var n=this.$row.find(".license-key-status");if("valid"==t.licenseKeyStatus||t.licenseIssues.length){var a=e("<span/>",{class:"license-key-status "+(0===t.licenseIssues.length?"valid":"")});n.length?n.replaceWith(a):a.appendTo(this.$row.find(".icon"))}else n.length&&n.remove();var i=this.$row.find(".edition");if(t.hasMultipleEditions||t.isTrial){var s=t.upgradeAvailable?e("<a/>",{href:Craft.getUrl("plugin-store/"+this.handle),class:"edition"}):e("<div/>",{class:"edition"});t.hasMultipleEditions&&e("<div/>",{class:"edition-name",text:t.edition}).appendTo(s),t.isTrial&&e("<div/>",{class:"edition-trial",text:Craft.t("app","Trial")}).appendTo(s),i.length?i.replaceWith(s):s.insertBefore(this.$row.find(".version"))}else i.length&&i.remove();var r=t.licenseKey||"unknown"!==t.licenseKeyStatus;if(r?(this.$keyContainer.removeClass("hidden"),t.licenseKey&&!this.$keyInput.val().match(/^\$/)&&this.$keyInput.val(Craft.PluginManager.normalizeUserKey(t.licenseKey))):this.$keyContainer.addClass("hidden"),r&&t.licenseIssues.length?this.$keyInput.addClass("error"):this.$keyInput.removeClass("error"),this.$row.find("p.error").remove(),t.licenseIssues.length){for(var l=e(),o=0;o<t.licenseIssues.length;o++){var d=void 0;switch(t.licenseIssues[o]){case"no_trials":d=Craft.t("app","Plugin trials are not allowed on this domain.");break;case"wrong_edition":d=Craft.t("app","This license is for the {name} edition.",{name:t.licensedEdition.charAt(0).toUpperCase()+t.licensedEdition.substring(1)})+' <button type="button" class="btn submit small formsubmit">'+Craft.t("app","Switch")+"</button>";break;case"mismatched":d=Craft.t("app",'This license is tied to another Craft install. Visit {accountLink} to detach it, or <a href="{buyUrl}">buy a new license</a>',{accountLink:'<a href="https://console.craftcms.com" rel="noopener" target="_blank">console.craftcms.com</a>',buyUrl:Craft.getCpUrl("plugin-store/buy/".concat(this.handle,"/").concat(t.edition))});break;case"astray":d=Craft.t("app","This license isn’t allowed to run version {version}.",{version:t.version});break;case"required":d=Craft.t("app","A license key is required.");break;default:d=Craft.t("app","Your license key is invalid.")}var p=e("<p/>",{class:"error",html:d});if("wrong_edition"===t.licenseIssues[o]){var u=e("<form/>",{method:"post","accept-charset":"UTF-8"}).append(Craft.getCsrfInput()).append(e("<input/>",{type:"hidden",name:"action",value:"plugins/switch-edition"})).append(e("<input/>",{type:"hidden",name:"pluginHandle",value:this.handle})).append(e("<input/>",{type:"hidden",name:"edition",value:t.licensedEdition})).append(p);Craft.initUiElements(u),l=l.add(u)}else l=l.add(p)}l.appendTo(this.$details),Craft.initUiElements()}var c=this.$row.find(".expired");if(t.expired){var h=e("<p/>",{class:"warning with-icon expired",html:Craft.t("app","This license has expired.")+" "+Craft.t("app","<a>Renew now</a> for another year of updates.").replace("<a>",'<a href="'+t.renewalUrl+'" target="_blank">')});c.length?c.replaceWith(h):h.appendTo(this.$details)}"trial"===t.licenseKeyStatus?(this.$buyBtn.removeClass("hidden"),t.licenseIssues.length?this.$buyBtn.addClass("submit"):this.$buyBtn.removeClass("submit")):this.$buyBtn.addClass("hidden")}})}(jQuery)}()}();
//# sourceMappingURL=PluginManager.js.map